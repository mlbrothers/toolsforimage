{% extends "en/base.html" %}

{% block meta_description %}
<meta name="description" content="Add watermarks to your images easily with our watermarking tool. Protect your images and add branding effortlessly.">
{% endblock %}

{% block title %}Image Watermarking Tool - ToolsForImage{% endblock %}

{% block content %}
<h1>Image Watermarking Tool</h1>

<div class="watermark-editor">
    <div class="watermark-controls">
        <input type="file" id="imageUpload" accept="image/*">
        <input type="text" id="watermarkText" placeholder="Enter watermark text">
        <input type="color" id="watermarkColor" value="#000000">
        <input type="range" id="watermarkOpacity" min="0" max="1" step="0.1" value="0.5">
        <input type="number" id="watermarkFontSize" min="8" value="20" placeholder="Font size">
        <select id="watermarkPosition">
            <option value="top-left">Top Left</option>
            <option value="top-right">Top Right</option>
            <option value="bottom-left">Bottom Left</option>
            <option value="bottom-right">Bottom Right</option>
            <option value="center">Center</option>
        </select>
        <select id="watermarkFontStyle">
            <option value="normal">Normal</option>
            <option value="bold">Bold</option>
            <option value="italic">Italic</option>
            <option value="bold-italic">Bold Italic</option>
        </select>
    </div>

    <div class="watermark-preview">
        <img id="previewImage" src="" alt="Preview">
    </div>

    <button class="button" id="applyWatermark">Apply Watermark</button>
    <button class="button" id="downloadImage">Download Watermarked Image</button>
</div>

<style>
    .watermark-editor {
        background-color: var(--box-color);
        border: 1px solid var(--secondary-color);
        padding: 2em;
        margin-top: 2em;
    }

    .watermark-controls {
        display: flex;
        flex-direction: column;
        gap: 1em;
        margin-bottom: 1em;
    }

    .watermark-controls input, .watermark-controls select {
        padding: 0.5em;
        font-size: 1em;
    }

    .watermark-preview {
        width: 100%;
        height: 400px;
        border: 1px solid var(--secondary-color);
        margin-bottom: 1em;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        position: relative;
    }

    .watermark-preview img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
    }

    .watermark-text {
        position: absolute;
        cursor: move;
        user-select: none;
    }

    .button {
        background-color: var(--link-hover-color);
        color: var(--background-color);
        border: none;
        padding: 0.5em 1em;
        font-size: 1em;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .button:hover {
        background-color: var(--link-hover-color);
        color: var(--box-color);
    }
</style>

<script>
    const imageUpload = document.getElementById('imageUpload');
    const watermarkText = document.getElementById('watermarkText');
    const watermarkColor = document.getElementById('watermarkColor');
    const watermarkOpacity = document.getElementById('watermarkOpacity');
    const watermarkFontSize = document.getElementById('watermarkFontSize');
    const watermarkPosition = document.getElementById('watermarkPosition');
    const watermarkFontStyle = document.getElementById('watermarkFontStyle');
    const previewImage = document.getElementById('previewImage');
    const applyWatermarkButton = document.getElementById('applyWatermark');
    const downloadButton = document.getElementById('downloadImage');

    let originalImage = null;

    imageUpload.addEventListener('change', (e) => {
        const file = e.target.files[0];
        const reader = new FileReader();

        reader.onload = (event) => {
            originalImage = new Image();
            originalImage.onload = () => {
                previewImage.src = originalImage.src;
            };
            originalImage.src = event.target.result;
        };

        reader.readAsDataURL(file);
    });

    applyWatermarkButton.addEventListener('click', applyWatermark);
    downloadButton.addEventListener('click', downloadWatermarkedImage);

    function applyWatermark() {
        if (!originalImage) {
            alert('Please upload an image first.');
            return;
        }

        const formData = new FormData();
        formData.append('image', imageUpload.files[0]);
        formData.append('watermarkText', watermarkText.value);
        formData.append('watermarkColor', watermarkColor.value);
        formData.append('watermarkOpacity', watermarkOpacity.value);
        formData.append('watermarkFontSize', watermarkFontSize.value);
        formData.append('watermarkPosition', watermarkPosition.value);
        formData.append('watermarkFontStyle', watermarkFontStyle.value);

        fetch('/watermark-image', {
            method: 'POST',
            body: formData
        })
        .then(response => response.blob())
        .then(blob => {
            const url = window.URL.createObjectURL(blob);
            previewImage.src = url;
        })
        .catch(error => console.error('Error:', error));
    }

    function downloadWatermarkedImage() {
        if (!originalImage) {
            alert('Please upload an image first.');
            return;
        }

        const a = document.createElement('a');
        a.href = previewImage.src;
        a.download = 'watermarked_image.png';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }
</script>
{% endblock %}
